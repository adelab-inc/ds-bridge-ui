# 02. 시스템 아키텍처

> **대상 독자**: 개발자, PM
> **기술 수준**: 중급 (개발자), 개념 이해 (PM)

## TL;DR (핵심 요약)

- **모노레포 구조**: 하나의 저장소에서 여러 프로젝트 관리
- **FE/AI 분리**: 프론트엔드와 AI 백엔드를 독립적으로 개발
- **API 기반 통신**: 명확한 인터페이스로 팀 간 병렬 개발 가능

---

## 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────────────┐
│                         사용자 브라우저                           │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      프론트엔드 (Next.js)                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  프롬프트    │  │  코드 에디터 │  │   프리뷰    │             │
│  │  입력 UI    │  │  (Monaco)   │  │ (Sandpack)  │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────┘
                                │
                                │ HTTP / WebSocket
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      AI 서버 (Python)                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  프롬프트    │  │   LLM      │  │  코드 파서   │             │
│  │  처리기     │  │  (Claude)   │  │  & 검증기   │             │
│  └─────────────┘  └─────────────┘  └─────────────┘             │
└─────────────────────────────────────────────────────────────────┘
```

### 간단한 설명

1. **사용자**가 브라우저에서 "로그인 페이지 만들어줘"라고 입력
2. **프론트엔드**가 이 요청을 AI 서버로 전달
3. **AI 서버**가 Claude API를 사용해 코드 생성
4. 생성된 코드가 **실시간 스트리밍**으로 프론트엔드에 전달
5. **프리뷰 영역**에서 생성된 코드가 즉시 렌더링

---

## 저장소 구조

### 모노레포란?

여러 개의 프로젝트를 **하나의 저장소**에서 관리하는 방식입니다.

**장점**:
- 코드 공유가 쉬움
- 일관된 개발 환경
- 한 번의 PR로 여러 프로젝트 수정 가능

**우리의 구조**:

```
ds-bridge-ui/                    # 메인 저장소 (모노레포)
│
├── apps/                        # 실행 가능한 애플리케이션들
│   ├── web/                     # 메인 웹 앱 ← FE 개발자 담당
│   └── preview/                 # 프리뷰 샌드박스 ← FE 개발자 담당
│
├── packages/                    # 공유 패키지들
│   ├── ui/                      # 공유 UI 컴포넌트 ← FE 개발자 담당
│   ├── ai-client/               # AI API 호출 클라이언트 ← FE 개발자 담당
│   ├── editor/                  # 에디터 관련 유틸리티 ← FE 개발자 담당
│   └── types/                   # 공유 타입 정의 ← 공동 관리
│
└── docs/                        # 문서
```

### AI 서버 (별도 저장소 또는 디렉토리)

```
ai-service/                      # AI 서버 ← AI 개발자 담당
├── src/
│   ├── api/                     # API 엔드포인트
│   ├── prompts/                 # 프롬프트 템플릿
│   ├── generators/              # 코드 생성 로직
│   └── validators/              # 코드 검증 로직
├── tests/
└── pyproject.toml               # Python 의존성
```

---

## 팀별 담당 영역

### 시각적 구분

```
┌─────────────────────────────────────────────────────────────────┐
│                    🟦 FE 개발자 담당 영역                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  apps/web         - 메인 웹 애플리케이션                   │   │
│  │  apps/preview     - 코드 프리뷰 샌드박스                   │   │
│  │  packages/ui      - 공유 UI 컴포넌트                      │   │
│  │  packages/editor  - 에디터 통합                           │   │
│  │  packages/ai-client - AI API 호출 (Mock 포함)            │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    🟨 AI 개발자 담당 영역                         │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  ai-service/      - AI 백엔드 서버                        │   │
│  │    - 프롬프트 엔지니어링                                    │   │
│  │    - LLM 통합 (Claude, GPT 등)                           │   │
│  │    - 코드 생성 파이프라인                                   │   │
│  │    - 코드 검증 및 후처리                                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    🟩 공동 관리 영역                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  packages/types   - API 요청/응답 타입 정의                 │   │
│  │  docs/           - 기술 문서                              │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 핵심 컴포넌트 설명

### 1. 메인 웹 앱 (apps/web)

사용자가 실제로 접속하는 웹 애플리케이션입니다.

**주요 페이지**:
- `/` - 랜딩 페이지
- `/editor` - AI 코드 생성 & 편집 화면
- `/projects` - 저장된 프로젝트 목록

**핵심 기능**:
- 프롬프트 입력 폼
- 코드 에디터 (Monaco Editor)
- 실시간 프리뷰
- 프로젝트 저장/불러오기

### 2. 프리뷰 샌드박스 (apps/preview)

생성된 코드를 안전하게 실행하는 격리된 환경입니다.

**왜 분리하나요?**
- 사용자가 생성한 코드가 악성일 수 있음
- 메인 앱과 격리하여 보안 확보
- 프리뷰 오류가 메인 앱에 영향 주지 않음

### 3. AI 클라이언트 (packages/ai-client)

AI 서버와 통신하는 클라이언트 라이브러리입니다.

**역할**:
```typescript
// 사용 예시
import { generateCode } from '@ds-bridge/ai-client';

const result = await generateCode({
  prompt: "로그인 폼 만들어줘",
  options: { framework: "react" }
});
```

**중요**: FE 개발자는 Mock 서버로 먼저 개발하고, 나중에 실제 AI 서버로 전환합니다.

### 4. AI 서버 (ai-service)

실제 코드 생성이 이루어지는 백엔드입니다.

**기술 선택 자유**:
- Python (LangChain, LlamaIndex)
- Node.js
- Go, Rust 등

**핵심 책임**:
- 프롬프트 최적화
- LLM API 호출
- 생성된 코드 검증
- 에러 처리

---

## 데이터 흐름

### 코드 생성 시퀀스

```
사용자          FE (Next.js)       AI Client       AI Server        LLM (Claude)
  │                 │                 │                │                 │
  │ 프롬프트 입력    │                 │                │                 │
  │────────────────>│                 │                │                 │
  │                 │ generateCode()  │                │                 │
  │                 │────────────────>│                │                 │
  │                 │                 │  POST /generate│                 │
  │                 │                 │───────────────>│                 │
  │                 │                 │                │  API 호출        │
  │                 │                 │                │────────────────>│
  │                 │                 │                │                 │
  │                 │                 │                │  스트리밍 응답   │
  │                 │                 │                │<────────────────│
  │                 │                 │  스트리밍 전달  │                 │
  │                 │                 │<───────────────│                 │
  │                 │  코드 청크 전달  │                │                 │
  │                 │<────────────────│                │                 │
  │  실시간 프리뷰   │                 │                │                 │
  │<────────────────│                 │                │                 │
  │                 │                 │                │                 │
```

### 스트리밍이란?

일반적인 방식:
```
요청 → [전체 생성 완료까지 대기...] → 한 번에 전체 응답
```

스트리밍 방식:
```
요청 → 코 → 드 → 가 → 조 → 금 → 씩 → 도 → 착
```

**사용자 경험**: 코드가 타이핑되듯 실시간으로 나타남

---

## 확장 고려사항

### 향후 추가될 수 있는 컴포넌트

```
                    ┌─────────────┐
                    │   CDN      │  ← 정적 자산 캐싱
                    └─────────────┘
                          │
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  인증 서버   │ ←── │   메인 앱   │ ──→ │   DB       │
│  (Auth0 등) │     │  (Next.js)  │     │ (Postgres) │
└─────────────┘     └─────────────┘     └─────────────┘
                          │
                          ▼
                    ┌─────────────┐
                    │  배포 서비스 │  ← Vercel, AWS 등
                    └─────────────┘
```

### MVP 이후 확장 계획

| 단계 | 추가 기능 | 필요 컴포넌트 |
|------|----------|--------------|
| v1.1 | 사용자 인증 | Auth 서버, DB |
| v1.2 | 프로젝트 저장 | Object Storage |
| v2.0 | 팀 협업 | 실시간 동기화 서버 |
| v2.1 | 원클릭 배포 | 배포 파이프라인 |

---

## 다음 문서

- [03. 기술 스택](./03-tech-stack.md) - 구체적인 기술 선택과 이유
- [04. API 계약](./04-api-contract.md) - FE ↔ AI 인터페이스 상세

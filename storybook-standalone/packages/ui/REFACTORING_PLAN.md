# 디자인 토큰 생성 시스템 리팩토링 계획

**문서 목적**: 현재 디자인 토큰 시스템의 문제점을 분석하고, 이를 해결하기 위한 구체적인 리팩토링 계획을 제시합니다.

---

## 1. 왜 바꿔야 하는가? (문제점 분석)

지금까지의 분석을 통해 현재 디자인 토큰 시스템의 두 가지 주요 문제점을 발견했습니다.

### 문제점 1: `aplus-cli`의 토큰 생성 명령어(`generate-ui`) 손실

-   **현상**: `Makefile`에 정의된 `make tokens-update-all` 워크플로우는 `aplus-cli design-tokens generate-ui`라는 명령어를 호출하도록 되어 있으나, 현재 `aplus-cli`에는 해당 명령어가 존재하지 않아 전체 자동화 파이프라인이 실패합니다.
-   **추정 원인**: Git 히스토리 분석 결과, 9월 15일경(`8e157e7`) CLI 리팩토링 과정에서 해당 명령어가 의도치 않게 제거되고 문서(`Makefile`, `CLAUDE.md`)가 업데이트되지 않은 것으로 보입니다.
-   **영향**: 이로 인해 Figma에서 디자인 토큰이 변경되어도 개발자가 이를 UI 라이브러리에 자동으로 반영할 수 없는, **자동화 워크플로우가 완전히 망가진 상태**입니다.

### 문제점 2: 코드에 디자인 시스템의 '참조 관계'가 없음

-   **현상**: 현재 자동 생성된 토큰 파일(`design-tokens.ts`, `figma-tokens.ts`)들은 모든 토큰의 **최종 계산된 색상 값(HEX, RGBA)만을 포함**하고 있습니다.
-   **문제**: 컬러 시스템의 핵심 원칙인 **"Role 토큰은 Palette 토큰을 참조(Alias)한다"**는 중요한 아키텍처 정보가 코드 레벨에서는 완전히 유실되었습니다.
    -   예를 들어, 코드만 봐서는 `role-bg-canvas` 토큰이 원래 `palette-neutral-gray-100` 토큰을 참조하고 있었다는 사실을 알 수 없습니다.
-   **영향**:
    1.  **유지보수 리스크**: `aplus-cli` 도구가 고장나 개발자가 수동으로 토큰을 수정해야 할 때, 어떤 팔레트 값을 참조해야 하는지 알 수 없어 **설계 의도를 잃어버리고 임의의 값을 넣게 될 위험**이 큽니다.
    2.  **소통 비용 증가**: 디자이너가 "Gray 100 색상을 변경합니다"라고 했을 때, 개발자는 어떤 `role` 토큰이 Gray 100을 사용하는지 역추적해야 하는 번거로움이 발생합니다.
    3.  **SSOT(Single Source of Truth) 원칙 위배**: `color.json`이 디자인의 SSOT라면, 최종 값만 가진 `design-tokens.ts`는 또 다른 독립적인 SSOT처럼 동작하여 데이터 불일치의 원인이 될 수 있습니다.

---

## 2. 어떻게 바꿔야 하는가? (개선 계획)

위 문제들을 해결하기 위해 `aplus-cli`의 토큰 생성 로직을 다음과 같이 리팩토링하고 복원합니다.

### 목표: 참조 관계를 유지하는 구조화된 토큰 생성

핵심은 **디자인 시스템의 아키텍처(참조 관계)를 코드에 명시적으로 남기는 것**입니다.

#### 단계 1: `aplus-cli` 명령어 복원 및 로직 개선

1.  **`generate` 명령어 구현**: `aplus-cli design-tokens`에 `generate` 서브커맨드를 새로 구현하여 손실된 `generate-ui` 기능을 대체합니다.
2.  **파서 로직 개선**: `color.json`을 파싱할 때, 최종 값만 해석하는 기존 방식과 더불어, **어떤 토큰이 어떤 토큰을 참조하는지에 대한 관계 정보**를 보존하는 새로운 파싱 로직을 추가합니다.

#### 단계 2: 새로운 구조화된 토큰 파일 생성

1.  **`structured-tokens.ts` 파일 도입**: `packages/ui/tokens/` 경로에 `structured-tokens.ts`라는 새로운 파일을 생성합니다. 이 파일은 다음과 같은 구조를 가집니다.
    ```typescript
    // 🎨 디자인 시스템 토큰 아키텍처 (참조 관계 유지)
    
    // 1. Palette: 실제 색상 값 정의 (SSOT)
    export const palette = {
      'neutral-gray-100': '#f4f6f8',
      // ... 모든 팔레트 토큰
    } as const;
    
    // 2. Role: Palette를 참조하는 별칭(Alias)
    export const role = {
      'bg-canvas': palette['neutral-gray-100'], // 👈 참조 관계를 코드로 명시
      // ... 모든 역할 토큰
    } as const;
    ```
2.  **역할**: 이 파일은 코드 레벨에서 디자인 시스템의 **새로운 SSOT** 역할을 하며, 디자이너와 개발자 간의 소통 기준점이 됩니다.

#### 단계 3: 기존 토큰 파일 생성 방식 수정

1.  **`design-tokens.ts` 역할 변경**: 이 파일은 계속 유지하되, 이제 `structured-tokens.ts` 파일을 기반으로 생성되는 **'최종 결과물(Flat file)'** 로서의 역할만 담당합니다. 즉, 모든 참조 관계가 해결된 최종 값들의 맵(map)을 가집니다.
2.  **생성 순서**: `aplus-cli ... generate` 명령어는 항상 `structured-tokens.ts`를 먼저 생성하고, 그 다음 이 파일을 기반으로 `design-tokens.ts`를 생성하도록 합니다.

#### 단계 4: 워크플로우 통합

1.  **`Makefile` 수정**: `Makefile`의 `tokens-update-all` 등 관련 명령어에서 `aplus-cli ... generate-ui`를 새로 만든 `aplus-cli ... generate`로 교체하여 전체 자동화 워크플로우를 복구합니다.

---

## 3. 기대 효과

이 리팩토링을 통해 다음과 같은 효과를 기대할 수 있습니다.

-   **워크플로우 복구**: 망가졌던 디자인 토큰 자동화 파이프라인이 완벽하게 복구됩니다.
-   **유지보수성 향상**: 자동화 스크립트가 없어도, `structured-tokens.ts` 파일만 보면 토큰 간의 관계를 명확히 알 수 있어 수동 유지보수가 매우 쉬워집니다.
-   **소통 효율성 증대**: 디자이너와 개발자가 동일한 구조(`palette` → `role`)를 보고 소통하므로 혼선이 줄어듭니다.
-   **시스템 투명성 확보**: 디자인 시스템의 아키텍처가 코드에 그대로 반영되어 시스템을 이해하기 쉬워집니다.
